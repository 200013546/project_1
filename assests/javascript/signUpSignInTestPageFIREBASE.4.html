<!DOCTYPE html>
<html>
<head>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="https://code.jquery.com/jquery.js"></script>


    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sign Up</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <script src="main.js"></script> -->
</head>
<body>

    <div id="container">
        <label for="email-input">email address:</label>
        <input id="email-input" label="Email address">
        <label for="password1-input">Create a password:</label>
        <input id="password1-input" type="password">
        <label for="password2-input">Re-enter password:</label>
        <input id="password2-input" type="password">
        <button id="signUp" >Join</button>
        <hr>

        <label for="email-input2">email address:</label>
        <input id="email-input2" label="Email address">
        <label for="password-input2">Password:</label>
        <input id="password-input2" type="password">
        <!-- <label for="password2-input">Re-enter password:</label>
        <input id="password2-input" type="password"> -->
        <button id="sign-in" >Sign In</button> 

        <div id="response"></div>

    </div>
    <!-- scripts js file start here Ronald Chaudry-->

        <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
        <script>
          // Initialize Firebase
          var config = {
            apiKey: "AIzaSyBDM99ZrsLu4tolJ_HzLJdqCH5b0O1RoJo",
            authDomain: "ronaldtestproject2.firebaseapp.com",
            databaseURL: "https://ronaldtestproject2.firebaseio.com",
            projectId: "ronaldtestproject2",
            storageBucket: "ronaldtestproject2.appspot.com",
            messagingSenderId: "976377199219"
          };
          firebase.initializeApp(config);
     
//new variables
var db = firebase.database();
var email = "";
var password1 = "";
var password2 = "";

//sign-UP by clicking JOIN
$("#signUp").on("click", function (events) {
    event.preventDefault();

        email = $("#email-input").val().trim();
        password1 = $("#password1-input").val().trim();
        password2 = $("#password2-input").val().trim();

    // checking passwords match
    if (password1 != password2) {
        $("#response").text("The passwords entered did not match");
        console.log("The passwords entered did not match. User " + email + " was NOT created!");
    }
    else {
        validateLength();
        }

    // Validate password length
    function validateLength () {
    if (password1.length < 5) {
        $("#response").text("The password must be at least 5 characters long.");    
        console.log("The passwords entered is too short. User " + email + " was NOT created!");    
    } else {
        //console.log("Password meets requirement!")
        validateEmail();
    }
    }

    //Check if it's a valid emailaddress
    function validateEmail() {
        var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
        if (email.match(mailformat)) {
            console.log("Email address provided ("+ email + ") meets email address format");
            console.log("Password meets requirement!")
            console.log("Creating new user " + email + " in database");
            dbWrite2();
        }
        else
        {
        $("#response").text(email + " is not a valid email address");
        console.log("The email address provided (" + email + ") is invalid");
        }
    }

        function dbWrite2() {
            email = email;
            password = password1;
            firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(error.code);
        console.log(error.message);
        //console.log("sent to firebse");

        // ...
        });
        console.log("sent to firebse");
    }

//create user in firebase
/*function dbWrite() {
    db.ref('/users').push({
          email: email,
          password: password1,
          highScore: 0,
      }, function (errorObject) {
          console.log("Error returned: " + errorObject);// Doesnt seem to like "code);""
      });
        $("#email-input").val("");
        $("#password1-input").val("");
        $("#password2-input").val("");
        $("#response").text("Your registration is complete!");
    } */
});

//sign in

    $("#sign-in").on("click", function (event) {
        event.preventDefault();
        email = $("#email-input2").val().trim();
        password = $("#password-input2").val().trim();

    firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log("errors code received: " + errorCode);
        console.log("errors message received: " + errorMessage);

        // ...
});
console.log("user " + email + " is attempting to login");
});
/*
db.ref("/users").on("child_added", function (childSnapshot, prevChildKey) {

    var dbItemKey = childSnapshot.key;
    var dbEmail = childSnapshot.val().email;
    var dbPassword = childSnapshot.val().password;
    var dbHighScore = childSnapshot.val().highScore;

    //console.log("User " + dbEmail + "'s password is " + dbPassword);
    //console.log(dbItemKey);

    $("#sign-in").on("click", function (event) {
        event.preventDefault();
        

        //console.log("Login attempt for " + loginEmail + " in progress");

        var loginEmail = $("#email-input2").val().trim();
        var loginPassword = $("#password-input2").val().trim();
        console.log("Login attempt for " + dbEmail + " in progress");

        //var emailRef = db().ref("users/");
        // var emailRef = firebase.database().ref("/users");

        // emailRef.orderByValue().on("value", function(data) {
        //     data.forEach(function(data) {
        //         console.log(data.dbEmail + " 's password is " + data.dbPassword);

        // var ratingRef = firebase.database().ref("users/");

        // ratingRef.orderByValue().on("value", function(data) {
        
        // data.forEach(function(data) {
        //     console.log("The " + data.dbEmail + " rating is " + data.val());
        // });
        
        // });
        //     })
        // })

        // if (loginEmail === dbEmail && loginPassword === dbPassword) {
        //     console.log("Passwords match for " + loginEmail);
        // } else
        // {
        //     console.log("Password incorrect");
        // }

        //new Firebase("https://examples-sql-queries.firebaseio.com/user")
        //new Firebase("https://console.firebase.google.com/project/ronaldtestproject2/database/ronaldtestproject2/data")
        //db.ref("/users")
        var  db2 = Firebase("https://ronaldtestproject2.firebaseio.com/users")
            db2.startAt(loginEmail)
            db2.endAt(loginEmail)
            db2.once('value', show);
            
            function show (snap) {
            console.log('accounts matching email address', snap.val().email);
    }//);
    })
    

}) */

    </script> 
</body>
</html>